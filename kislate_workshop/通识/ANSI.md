## 一、ASCII码

ASCII（American Standard Code for Information Interchange，美国信息交换标准代码）最初的设计是一个7位的字符编码，使用了从0到127的数字来表示字符。这意味着它总共可以表示128个不同的字符。这包括了英文大小写字母、数字、一些标点符号以及一些控制字符（如换行、回车等）。

后来，随着计算机技术的发展和对更多字符集的需求增长，ASCII码被扩展到了8位（1个字节）。这个扩展后的版本通常称为扩展ASCII或高ASCII，并且它允许包含额外的128个字符，从而总共可以表示256个字符。这些额外的字符集通常用来表示其他符号、控制代码，以及其他语言的特殊字符。

ASCII 字符集中的数字0到31以及数字127对应的是控制字符（control characters），也被称为非打印字符（non-printing characters）。它们不代表可视化的字符，而是用来控制文本的传输和显示行为。以下是一些常见控制字符的描述：

- 0 (NUL): 空字符 (Null character)，经常用于标记字符串的结束。
- 1 (SOH): 标题开始 (Start of Header)，用于通信协议中的消息开始。
- 2 (STX): 正文开始 (Start of Text)，标记文本实际内容的开始。
- 3 (ETX): 正文结束 (End of Text)，通常标记传输结束。
- 4 (EOT): 传输结束 (End of Transmission)，用于终止一个传输序列。
- 5 (ENQ): 询问字符 (Enquiry)，用于请求远端发送响应。
- 6 (ACK): 确认字符 (Acknowledge)，是对接收数据成功的响应。
- 7 (BEL): 响铃 (Bell)，当解释此字符时会发出声音或视觉信号。
- 8 (BS): 退格 (Backspace)，使光标向左移动一位。
- 9 (HT): 水平制表符 (Horizontal Tab)，用于控制文本的横向间隔。
- 10 (LF): 换行 (Line Feed)，在Unix和Unix-like系统中用于开始新的一行。
- 11 (VT): 垂直制表符 (Vertical Tab)，用于控制文本的纵向间隔。
- 12 (FF): 走纸换页 (Form Feed)，在打印机中用来将纸张推进到下一页的位置。
- 13 (CR): 回车 (Carriage Return)，在Mac OS之前和Windows系统中用于返回行首，并在Windows中与 LF 一起组合使用来开始新的一行。
- 14 (SO): 移位输出 (Shift Out)，用于临时切换到另一套字符集。
- 15 (SI): 移位输入 (Shift In)，用于返回标准字符集。
- 16 到 31: 其他控制功能，包括文件分隔、组分隔、记录分隔等。
- 127 (DEL): 删除 (Delete)，用于删除前一个字符，通常是逻辑删除而非物理删除。

这些控制字符在现代文本编辑和显示中通常不经常直接使用，但在通信协议、文件格式和程序语言中仍发挥作用。例如，LF 和 CR 在不同操作系统中的文本文件中作为换行的标记。而 NUL 字符经常用在某些编程语言中表示字符串的终止。

## 二、ANSI转义序列

ANSI是（American National Standards Institute）的缩写。控制字符的数量限制使得它们不足以满足控制现代终端设备的所有需求，特别是在文本格式化和复杂的界面控制方面。为了解决这个问题，引入了转义序列这一概念，它允许使用更复杂的指令来控制终端的行为。

大部分情况下，ANSI转义序列都是以 ESC 开头的，所以是(ANSI escape codes)或者(ANSI escape sequences)。

### 1. ANSI转义序列C0列表

这些是控制字符，用于文本处理中的特殊功能，如回车（CR）、换行（LF）等。这些字符的代码通常在ASCII的0x00到0x1F范围内。

### 2. ANSI转义序列C1列表

C1控制字符用于扩展的文本控制目的，比如开始定向控制（SDC）或单字符强调（SCI）。这些字符的代码范围通常是0x80到0x9F。

| 序列符号 | 码值 | 名称 | 作用 |
| --- | --- | --- | --- |
| ESC N | 0x8e | SS2-Single Shift Two | 用来从替代字符集中选择字符。在兼容ANSI的系统中，SS2通常用来临时切换到G2字符集，以访问特殊字符。 |
| ESC O | 0x8f | SS3-Single Shift Three | 用来从替代字符集中选择字符。在兼容ANSI的系统中，SS3用于临时切换到G3字符集。 |
| ESC P | 0x90 | DCS-Device Control String | 用于传输设备控制信息，这些信息被设备或终端用来执行特定的硬件控制功能，例如，xterm中可能用来定义键位映射或请求设置。 |
| ESC [ | 0x9b | CSI-Control Sequence Introducer | 用于引入一系列控制序列，它结束于ASCII 64到126之间的字符。此序列用于多种光标和显示控制操作。 |
| ESC \ | 0x9c | ST-String Terminator | 终止一个控制字符串，如APC、DCS、OSC、PM和SOS这样的序列。 |
| ESC ] | 0x9d | OSC-Operating System Command | 用于传输操作系统级别的命令或请求，如设置窗口标题或其他属性。在xterm中，这些控制序列可以由ST终止，或者通常也可以由BEL终止。 |
| ESC X | 0x98 | SOS-Start of String | 用来标记一个控制字符串的开始，这个字符串不是用来被终端直接处理，而是作为私有消息传递给应用程序。 |
| ESC ^ | 0x9e | PM-Privacy Message | 用于传输私有消息，这些消息不应该被记录或存储，用于敏感信息传输。 |
| ESC _ | 0x9f | APC-Application Program Command | 用于传输应用程序命令，这些命令通常由特定的软件应用来解释和执行。 |
| ESC c | 0x1b c | RIS-Reset to Initial State | 用于将终端或设备重置到其初始状态。可能包括重置图形属性、清除制表符、恢复默认字体等。 |

### 3. Control Sequence Introducer（CSI）序列

Control Sequence Introducer（CSI）序列是ANSI转义序列的一部分，用于更加复杂的终端控制，如光标移动、文本格式设置、颜色变化等。CSI序列通常以（ESC，ASCII码为十进制的27 ，或十六进制 0x1B，或八进制的033，或转义字符\e）和左方括号[开头，紧跟着是参数字节、中间字节（如果有的话），并以最终字节结束。终端设备接收到转义符后，会预期接下来的字符形成一个完整的转义序列，并根据这些序列来执行相应的操作，而不是将这些字符显示在屏幕上。

```
ESC [ 参数字节 ; 参数字节 ... 中间字节 最终字节
```

- ESC [：这两个字符是CSI序列的引导符，用于开始这个序列。
- 参数字节：这些通常是数字字符，用于提供具体的参数，如光标位置、颜色代码或其他选项。参数之间可以用分号;分隔。
- 中间字节：这部分是可选的，用于进一步控制或区分操作。
- 最终字节：表示CSI序列的结束，并触发终端执行相应的命令。这通常是ASCII码表中的@到~之间的字符。

| 组成部分 | 字符范围 | ASCII |
| --- | --- | --- |
| 参数字节 | 0x30–0x3F | 0–9:;<=>? |
| 中间字节 | 0x20–0x2F | space、!"#$%&'()*+,-./ |
| 最终字节 | 0x40–0x7E | @A–Z[\]^_a–z{ |

CSI（Control Sequence Introducer）控制序列用于在终端中执行各种控制操作，例如移动光标、修改文本属性、清除屏幕等。

### 4. SGR(Select Graphic Rendition)选择图形再现参数

SGR（Select Graphic Rendition）是一种 ANSI 转义码序列，用于在文本终端中设置文本属性，包括颜色、样式和其他外观效果。它允许开发者控制文本在终端上的呈现方式，从而创建出更丰富多彩的用户界面和输出效果。

SGR 序列由 ESC（Escape）字符后跟着零个或多个以分号分隔的参数组成，然后以字母 "m" 结束。参数用于指定要应用的不同文本属性，例如颜色、粗体、斜体等。每个参数都对应一个特定的文本属性，可以单独使用，也可以组合在一起以实现复杂的效果。

#### SGR参数

| 代码 | 作用 | 备注 |
| --- | --- | --- |
| 0 | 重置/正常 | 关闭所有属性。 |
| 1 | 粗体或增加强度 |  |
| 2 | 弱化（降低强度） | 未广泛支持。 |
| 3 | 斜体 | 未广泛支持。有时视为反相显示。 |
| 4 | 下划线 |  |
| 5 | 缓慢闪烁 | 低于每分钟150次。 |
| 6 | 快速闪烁 | MS-DOS ANSI.SYS；每分钟150以上；未广泛支持。 |
| 7 | 反显 | 前景色与背景色交换。 |
| 8 | 隐藏 | 未广泛支持。 |
| 9 | 划除 | 字符清晰，但标记为删除。未广泛支持。 |
| 10 | 主要（默认）字体 |  |
| 11–19 | 替代字体 | 选择替代字体。 |
| 20 | 尖角体 | 几乎无支持。 |
| 21 | 关闭粗体或双下划线 | 关闭粗体未广泛支持；双下划线几乎无支持。 |
| 22 | 正常颜色或强度 | 不强不弱。 |
| 23 | 非斜体、非尖角体 |  |
| 24 | 关闭下划线 | 去掉单双下划线。 |
| 25 | 关闭闪烁 |  |
| 27 | 关闭反显 |  |
| 28 | 关闭隐藏 |  |
| 29 | 关闭划除 |  |
| 30–37 | 设置前景色 | 参见下面的3位色。 |
| 38 | 设置前景色 | 下一个参数是5;n（8位色）或2;r;g;b（24位色），两种参数形式，参见下面的8位色和24位色。 |
| 39 | 默认前景色 | 由具体实现定义（按照标准）。 |
| 40–47 | 设置背景色 | 参见下面的3位色。 |
| 48 | 设置背景色 | 下一个参数是5;n（8位色）或2;r;g;b（24位色），两种参数形式，参见下面的8位色和24位色。 |
| 49 | 默认背景色 | 由具体实现定义（按照标准）。 |
| 51 | Framed |  |
| 52 | Encircled |  |
| 53 | 上划线 |  |
| 54 | Not framed or encircled |  |
| 55 | 关闭上划线 |  |
| 60 | 表意文字下划线或右边线 | 几乎无支持。 |
| 61 | 表意文字双下划线或双右边线 |  |
| 62 | 表意文字上划线或左边线 |  |
| 63 | 表意文字双上划线或双左边线 |  |
| 64 | 表意文字着重标志 |  |
| 65 | 表意文字属性关闭 | 重置60–64的所有效果。 |
| 90–97 | 设置明亮的前景色 | aixterm（非标准）。参见下面的4位颜色。 |
| 100–107 | 设置明亮的背景色 | aixterm（非标准）。参见下面的4位颜色。 |

#### 3位（不包括后面的明亮颜色）或4位色基本颜色代码

前景色：

| SGR参数 | 颜色 | 明亮颜色（粗体） |
| --- | --- | --- |
| 30 | 黑色 | 90（明亮黑色） |
| 31 | 红色 | 91（明亮红色） |
| 32 | 绿色 | 92（明亮绿色） |
| 33 | 黄色 | 93（明亮黄色） |
| 34 | 蓝色 | 94（明亮蓝色） |
| 35 | 品红 | 95（明亮品红） |
| 36 | 青色 | 96（明亮青色） |
| 37 | 白色 | 97（明亮白色） |

背景色：

| SGR参数 | 颜色 | 明亮颜色（粗体） |
| --- | --- | --- |
| 40 | 黑色背景 | 100（明亮黑色背景） |
| 41 | 红色背景 | 101（明亮红色背景） |
| 42 | 绿色背景 | 102（明亮绿色背景） |
| 43 | 黄色背景 | 103（明亮黄色背景） |
| 44 | 蓝色背景 | 104（明亮蓝色背景） |
| 45 | 品红背景 | 105（明亮品红背景） |
| 46 | 青色背景 | 106（明亮青色背景） |
| 47 | 白色背景 | 107（明亮白色背景） |

颜色卡（这里是使用Microsoft Visual Studio 调试控制台得到的，不同平台可能不一样）：

![颜色卡](path/to/color_chart.png)

#### 实例

```c
#include <stdio.h>
 
int main() {
    // 黑色文字，红色背景
    printf("\033[30;41mBlack text on Red background\033[0m\n");
 
    // 明亮蓝色文字，黄色背景
    printf("\033[1;34;43mBright Blue text on Yellow background\033[0m\n");
 
    // 明亮白色文字，品红背景
    printf("\033[1;37;45mBright White text on Magenta background\033[0m\n");
 
    return 0;
}
```

运行结果：

![运行结果](path/to/result.png)

小特性：

对于这里的参数，如果在printf这类格式化打印的函数中甚至可以实现这样：

```c
int num = 46;
printf("\033[%dm      \033[0m\n", num);
```

运行结果：

![运行结果](path/to/result.png)

这里的参数使用printf格式化字符串的特性，利用printf后面的参数来改变这里的参数。可以利用 printf 函数的格式化字符串功能以及后续的参数来动态地改变 ANSI 转义序列中的值。同时这里还有一个现象，就是设置好背景色后再打印空格，就可以打印一定长度的色块。

一般在printf中使用 \033[1;37;45m 之类的转义字符来对打印内容的前景和背景的颜色进行调整后，要再次使用 \033[0m 转义字符来重置所有属性，以防对后面的颜色调整产生影响。

可以发现这里的转义序列可以同时对多个属性进行调整，例如 \033[1;37;45m 同时设置粗体（明亮）字体、白色前景（字体）和品红背景三个属性。

8位色提供了更广泛的颜色选择，让开发者可以从256种预定义的颜色中选择。这是一种更灵活的颜色控制方式，允许更细粒度地定义所需的颜色。

### 5. 8位色

格式：

前景色：ESC[38;5;n ... m
背景色：ESC[48;5;n ... m

参数38确定是设置前景色，参数48确定是设置背景色。其中，n是0到255之间的整数，对应于预定义的颜色索引，...代表其他参数，m是结束字符。

颜色范围：

8位色提供了256种不同的颜色，范围从0到255。这些颜色包括：

- 0-7：标准颜色，与ANSI标准的30-37前景色和40-47背景色相对应。
- 8-15：高强度颜色，通常与标准颜色的亮度略有不同，与ANSI标准的90-97前景色和100-107背景色相对应。
- 16-231：这个范围内的颜色是通过一种计算方法生成的，可以产生216种颜色。它们的色彩是由RGB色彩立方体中的各种组合生成的，其中红、绿和蓝的值各有6个等级。具体的计算公式为：，其中：( r, g, b ) 分别是红色、绿色和蓝色的强度值，每种颜色的强度值范围从0到5。这个公式允许每种颜色分量（红、绿、蓝）独立地选择从0到5的六个强度级别，也就是说（0 ≤ r，g，b ≤ 5），从而可以生成216种不同的颜色组合。
- 232-255：这个范围内的颜色是从黑色到白色的
