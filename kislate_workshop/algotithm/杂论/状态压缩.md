
---

# ğŸ§© é¢˜ç›®è§£æï¼šã€ŒSCOI2005ã€äº’ä¸ä¾µçŠ¯

## ğŸ”¹é¢˜ç›®æè¿°

åœ¨ä¸€ä¸ª $ N \times N $ çš„æ£‹ç›˜ä¸­æ”¾ç½® $ K $ ä¸ªå›½ç‹ï¼ˆKingï¼‰ï¼Œä½¿å¾—å®ƒä»¬äº’ç›¸ä¸èƒ½æ”»å‡»ã€‚å›½ç‹å¯ä»¥æ”»å‡»å‘¨å›´ 8 ä¸ªæ–¹å‘çš„æ ¼å­ã€‚

æ±‚è¿™æ ·çš„åˆæ³•æ‘†æ”¾æ–¹æ¡ˆæ•°ã€‚

### è¾“å…¥æ ¼å¼ï¼š
- ç¬¬ä¸€è¡Œä¸¤ä¸ªæ•´æ•° $ N $ å’Œ $ K $

### è¾“å‡ºæ ¼å¼ï¼š
- ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ‰€æœ‰åˆæ³•çš„æ‘†æ³•æ€»æ•°

### æ•°æ®èŒƒå›´ï¼š
- $ 1 \leq N \leq 9 $
- $ 1 \leq K \leq N^2 $

---

## ğŸ’¡è§£é¢˜æ€è·¯ï¼šçŠ¶å‹åŠ¨æ€è§„åˆ’ï¼ˆState Compression DPï¼‰

ç”±äº $ N \leq 9 $ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **çŠ¶æ€å‹ç¼©åŠ¨æ€è§„åˆ’ï¼ˆçŠ¶å‹ DPï¼‰** æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

æ¯ä¸€è¡Œçš„çŠ¶æ€å¯ä»¥ç”¨ä¸€ä¸ªæ•´æ•°æ¥è¡¨ç¤ºï¼Œå…¶ä¸­æ¯ä¸€ä½è¡¨ç¤ºè¯¥åˆ—æ˜¯å¦æ”¾ç½®å›½ç‹ï¼ˆ0 è¡¨ç¤ºä¸æ”¾ï¼Œ1 è¡¨ç¤ºæ”¾ï¼‰ã€‚ä¾‹å¦‚ï¼Œ`100101` è¡¨ç¤ºç¬¬ 0ã€2ã€5 åˆ—æ”¾ç½®äº†å›½ç‹ã€‚

### çŠ¶æ€è®¾è®¡ï¼š

æˆ‘ä»¬å®šä¹‰ä»¥ä¸‹å˜é‡ï¼š

- `sit[j]`ï¼šç¬¬ j ä¸ªåˆæ³•çŠ¶æ€çš„äºŒè¿›åˆ¶è¡¨ç¤º
- `sta[j]`ï¼šç¬¬ j ä¸ªçŠ¶æ€ä¸­æ”¾äº†å¤šå°‘ä¸ªå›½ç‹ï¼ˆå³ sit[j] ä¸­ 1 çš„ä¸ªæ•°ï¼‰
- `f[i][j][l]`ï¼šå‰ i è¡Œï¼Œç¬¬ i è¡Œçš„çŠ¶æ€æ˜¯ç¬¬ j ä¸ªåˆæ³•çŠ¶æ€ï¼Œæ€»å…±å·²ç»æ”¾ç½® l ä¸ªå›½ç‹æ—¶çš„æ–¹æ¡ˆæ•°

---

## âœ…ç®—æ³•æ­¥éª¤è¯¦è§£

### Step 1: é¢„å¤„ç†æ‰€æœ‰åˆæ³•çš„ä¸€è¡ŒçŠ¶æ€

ä½¿ç”¨ DFS æšä¸¾å‡ºæ‰€æœ‰ä¸€è¡Œå†…ä¸ä¼šç›¸é‚»çš„å›½ç‹æ‘†æ”¾æ–¹å¼ã€‚

```cpp
void dfs(int x, int num, int cur) {
  if (cur >= n) {  // å½“å‰è¡Œæ„é€ å®Œæˆ
    sit[++cnt] = x;   // å­˜å‚¨å½“å‰åˆæ³•çŠ¶æ€
    sta[cnt] = num;   // è®°å½•å›½ç‹æ•°é‡
    return;
  }
  dfs(x, num, cur + 1);               // å½“å‰åˆ—ä¸æ”¾å›½ç‹
  dfs(x + (1 << cur), num + 1, cur + 2);  // å½“å‰åˆ—æ”¾å›½ç‹ï¼Œè·³è¿‡ä¸‹ä¸€åˆ—é¿å…å†²çª
}
```

### Step 2: åˆå§‹åŒ–ç¬¬ä¸€è¡Œçš„çŠ¶æ€

```cpp
for (int j = 1; j <= cnt; j++)
  f[1][j][sta[j]] = 1;  // ç¬¬ä¸€è¡Œåªæœ‰å½“å‰çŠ¶æ€çš„å›½ç‹æ•°é‡ä¸º sta[j]
```

### Step 3: åŠ¨æ€è§„åˆ’è½¬ç§»

æšä¸¾æ¯ä¸€è¡Œã€å½“å‰è¡ŒçŠ¶æ€å’Œä¸Šä¸€è¡ŒçŠ¶æ€ï¼Œåˆ¤æ–­æ˜¯å¦å…¼å®¹åè¿›è¡ŒçŠ¶æ€è½¬ç§»ï¼š

```cpp
bool compatible(int j, int x) {
  if (sit[j] & sit[x]) return false;            // æ­£ä¸Šæ–¹å†²çª
  if ((sit[j] << 1) & sit[x]) return false;     // å·¦ä¸Šæ–¹å†²çª
  if (sit[j] & (sit[x] << 1)) return false;     // å³ä¸Šæ–¹å†²çª
  return true;
}
```

ä¸»å¾ªç¯å¦‚ä¸‹ï¼š

```cpp
for (int i = 2; i <= n; i++)                  // æšä¸¾è¡Œæ•°
  for (int j = 1; j <= cnt; j++)              // å½“å‰è¡ŒçŠ¶æ€
    for (int x = 1; x <= cnt; x++) {          // ä¸Šä¸€è¡ŒçŠ¶æ€
      if (!compatible(j, x)) continue;        // æ’é™¤ä¸åˆæ³•è½¬ç§»
      for (int l = sta[j]; l <= k; l++)       // æ”¾ç½®å›½ç‹æ€»æ•°
        f[i][j][l] += f[i - 1][x][l - sta[j]];
    }
```

### Step 4: ç»Ÿè®¡æœ€ç»ˆç­”æ¡ˆ

```cpp
long long ans = 0;
for (int i = 1; i <= cnt; i++)
  ans += f[n][i][k];  // æœ€åä¸€è¡Œæ€»å…±æœ‰ k ä¸ªå›½ç‹çš„æ‰€æœ‰åˆæ³•çŠ¶æ€ä¹‹å’Œ
cout << ans << endl;
```

---

## ğŸ“å®Œæ•´ C++ å®ç°ä»£ç ï¼ˆå«è¯¦ç»†æ³¨é‡Šï¼‰

```cpp
#include <algorithm>
#include <iostream>
using namespace std;

// sit[j]: ç¬¬ j ä¸ªåˆæ³•çŠ¶æ€çš„äºŒè¿›åˆ¶è¡¨ç¤º
// sta[j]: ç¬¬ j ä¸ªçŠ¶æ€ä¸­æ”¾äº†å¤šå°‘ä¸ªå›½ç‹
long long sta[2005], sit[2005];
// f[i][j][l]: å‰ i è¡Œï¼Œç¬¬ i è¡ŒçŠ¶æ€ä¸º jï¼Œå…±æ”¾ l ä¸ªå›½ç‹çš„æ–¹æ¡ˆæ•°
long long f[15][2005][105];

int n, k, cnt;  // cnt ç”¨äºè®°å½•åˆæ³•çŠ¶æ€çš„æ•°é‡

// æ·±åº¦ä¼˜å…ˆæœç´¢ç”Ÿæˆæ‰€æœ‰åˆæ³•çš„ä¸€è¡ŒçŠ¶æ€
void dfs(int x, int num, int cur) {
  if (cur >= n) {  // ä¸€è¡Œæ„é€ å®Œæˆ
    sit[++cnt] = x;    // å­˜å‚¨çŠ¶æ€
    sta[cnt] = num;    // ç»Ÿè®¡å›½ç‹æ•°é‡
    return;
  }
  dfs(x, num, cur + 1);                 // å½“å‰åˆ—ä¸æ”¾å›½ç‹
  dfs(x + (1 << cur), num + 1, cur + 2);  // å½“å‰åˆ—æ”¾å›½ç‹ï¼Œè·³è¿‡ä¸‹ä¸€åˆ—
}

// åˆ¤æ–­ä¸Šä¸‹ä¸¤è¡ŒçŠ¶æ€æ˜¯å¦å†²çª
bool compatible(int j, int x) {
  if (sit[j] & sit[x]) return false;             // æ­£ä¸Šæ–¹å†²çª
  if ((sit[j] << 1) & sit[x]) return false;      // å·¦ä¸Šæ–¹å†²çª
  if (sit[j] & (sit[x] << 1)) return false;      // å³ä¸Šæ–¹å†²çª
  return true;
}

int main() {
  cin >> n >> k;

  dfs(0, 0, 0);  // é¢„å¤„ç†æ‰€æœ‰åˆæ³•çŠ¶æ€

  // åˆå§‹åŒ–ç¬¬ä¸€è¡Œ
  for (int j = 1; j <= cnt; j++)
    f[1][j][sta[j]] = 1;

  // åŠ¨æ€è§„åˆ’è½¬ç§»
  for (int i = 2; i <= n; i++)                  // æšä¸¾è¡Œæ•°
    for (int j = 1; j <= cnt; j++)              // å½“å‰è¡ŒçŠ¶æ€
      for (int x = 1; x <= cnt; x++) {          // ä¸Šä¸€è¡ŒçŠ¶æ€
        if (!compatible(j, x)) continue;        // å¦‚æœå†²çªåˆ™è·³è¿‡
        for (int l = sta[j]; l <= k; l++)       // æšä¸¾æ€»å›½ç‹æ•°
          f[i][j][l] += f[i - 1][x][l - sta[j]];  // è½¬ç§»æ–¹ç¨‹
      }

  // ç»Ÿè®¡æœ€ç»ˆç­”æ¡ˆ
  long long ans = 0;
  for (int i = 1; i <= cnt; i++)
    ans += f[n][i][k];  // æ‰€æœ‰æœ€åä¸€è¡Œä¸”æ€»å…±æœ‰ k ä¸ªå›½ç‹çš„æ–¹æ¡ˆæ•°ä¹‹å’Œ

  cout << ans << endl;

  return 0;
}
```

---

## ğŸ§ æ€»ç»“

| æŠ€æœ¯ç‚¹ | è¯´æ˜ |
|--------|------|
| **çŠ¶æ€å‹ç¼©** | ä½¿ç”¨äºŒè¿›åˆ¶æ•´æ•°è¡¨ç¤ºæ¯è¡Œçš„å›½ç‹åˆ†å¸ƒ |
| **DFSé¢„å¤„ç†** | æå‰æ‰¾å‡ºæ‰€æœ‰åˆæ³•çŠ¶æ€ï¼Œå‡å°‘æ— æ•ˆæšä¸¾ |
| **å…¼å®¹æ€§åˆ¤æ–­** | æ£€æŸ¥ä¸Šä¸‹è¡Œä¹‹é—´æ˜¯å¦ä¼šæœ‰æ”»å‡»æƒ…å†µ |
| **DPä¼˜åŒ–** | ä½¿ç”¨ä¸‰ç»´æ•°ç»„è¿›è¡ŒçŠ¶æ€è½¬ç§»ï¼Œè®°å½•å›½ç‹æ•°é‡ |
| **æ—¶é—´å¤æ‚åº¦** | å¤§çº¦ä¸º $ O(N \cdot C^2 \cdot K) $ï¼Œå…¶ä¸­ C æ˜¯åˆæ³•çŠ¶æ€æ•°ï¼ˆæœ€å¤šå‡ ç™¾ï¼‰ |

---

## ğŸ“Œè¡¥å……å»ºè®®

- å¯ä»¥å°è¯•ç”¨æ»šåŠ¨æ•°ç»„ä¼˜åŒ–ç©ºé—´ã€‚
- å¯¹äºè¾ƒå¤§çš„ `k`ï¼Œå¯ä»¥åœ¨è½¬ç§»æ—¶åšå‰ªæã€‚
- è‹¥æƒ³æ‹“å±•æ€è·¯ï¼Œå¯å°è¯•ç±»ä¼¼é¢˜ç›®å¦‚ **ç‚®å…µé˜µåœ°**ã€**ç‰ç±³ç”°** ç­‰çŠ¶å‹ DP å…¸å‹é¢˜ã€‚

---

## ğŸ§® å˜é‡å®šä¹‰å›é¡¾

```cpp
long long sta[2005], sit[2005];  // çŠ¶æ€æ•°ç»„
int n, k, cnt;                    // cntï¼šåˆæ³•çŠ¶æ€çš„æ•°é‡ï¼ˆè®¡æ•°å™¨ï¼‰
```

- `sit[]`ï¼šå­˜å‚¨æ¯ä¸€è¡Œçš„åˆæ³•çŠ¶æ€ï¼ˆäºŒè¿›åˆ¶æ•´æ•°è¡¨ç¤ºï¼‰
- `sta[]`ï¼šå¯¹åº”æ¯ä¸ªçŠ¶æ€ä¸­æ”¾äº†å¤šå°‘ä¸ªå›½ç‹ï¼ˆå³è¯¥äºŒè¿›åˆ¶æ•°ä¸­ 1 çš„ä¸ªæ•°ï¼‰
- `cnt`ï¼šæ¯ç”Ÿæˆä¸€ä¸ªåˆæ³•çŠ¶æ€å°±é€’å¢ä¸€æ¬¡ï¼Œæœ€ç»ˆè¡¨ç¤ºæ€»å…±æœ‰å¤šå°‘ç§åˆæ³•çš„ä¸€è¡Œå›½ç‹æ‘†æ”¾æ–¹å¼

---

## ğŸ” `cnt` çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼ˆDFS é¢„å¤„ç†ï¼‰

```cpp
void dfs(int x, int num, int cur) {
  if (cur >= n) {                  // å½“å‰è¡Œæ„é€ å®Œæˆ
    sit[++cnt] = x;                // å­˜å‚¨å½“å‰çŠ¶æ€
    sta[cnt] = num;                // å­˜å‚¨å›½ç‹æ•°é‡
    return;
  }
  dfs(x, num, cur + 1);            // ä¸æ”¾å›½ç‹
  dfs(x + (1 << cur), num + 1, cur + 2);  // æ”¾å›½ç‹ï¼Œè·³è¿‡ä¸‹ä¸€åˆ—
}
```

### âœ…ä¸¾ä¾‹è¯´æ˜ï¼š

å‡è®¾ `n=3`ï¼Œæ£‹ç›˜æœ‰ 3 åˆ—ã€‚

DFS æšä¸¾æ‰€æœ‰ä¸ç›¸é‚»çš„å›½ç‹æ”¾ç½®æ–¹å¼ï¼Œä¾‹å¦‚ï¼š

| çŠ¶æ€ç¼–å· | äºŒè¿›åˆ¶è¡¨ç¤º | å›½ç‹æ•°é‡ | åˆæ³•ï¼Ÿ |
|----------|-------------|-----------|--------|
| 1        | 000         | 0         | âœ…     |
| 2        | 001         | 1         | âœ…     |
| 3        | 010         | 1         | âœ…     |
| 4        | 100         | 1         | âœ…     |
| 5        | 101         | 2         | âœ…     |

å…¶ä¸­ï¼š
- `sit[1] = 0b000 = 0`
- `sit[2] = 0b001 = 1`
- `sit[3] = 0b010 = 2`
- ...
- `sta[5] = 2`

æ‰€ä»¥ï¼Œ**`cnt` æœ€ç»ˆçš„å€¼æ˜¯è¿™äº›åˆæ³•çŠ¶æ€çš„æ€»æ•°**ã€‚

---

## ğŸ“Œ ä¸ºä»€ä¹ˆåé¢ç”¨ `cnt` åšç»ˆæ­¢æ¡ä»¶ï¼Ÿ

åœ¨ä¸»å‡½æ•°ä¸­æœ‰å¦‚ä¸‹ç»“æ„ï¼š

```cpp
for (int j = 1; j <= cnt; j++) { ... }
```

### è¿™æ˜¯å› ä¸ºï¼š

- `j` è¡¨ç¤ºâ€œç¬¬ j ä¸ªåˆæ³•çŠ¶æ€â€
- æˆ‘ä»¬åªå…³å¿ƒè¿™äº›åˆæ³•çš„çŠ¶æ€ï¼Œå› ä¸ºéæ³•çŠ¶æ€ï¼ˆæ¯”å¦‚ç›¸é‚»ä¸¤ä¸ªä½ç½®éƒ½æ”¾å›½ç‹ï¼‰å·²ç»è¢« DFS æ’é™¤åœ¨å¤–äº†ã€‚
- æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä» `1` åˆ° `cnt` æšä¸¾æ‰€æœ‰åˆæ³•çŠ¶æ€å³å¯ï¼Œä¸éœ€è¦éå†æ‰€æœ‰ $ 2^n $ ç§å¯èƒ½ã€‚

### â±ï¸ æ•ˆç‡æå‡ï¼š

å¦‚æœä¸é¢„å¤„ç†ï¼Œä¸€è¡Œæœ€å¤šæœ‰ $ 2^n $ ç§çŠ¶æ€ï¼ˆæŒ‡æ•°çº§ï¼‰ï¼Œä½†é€šè¿‡ DFS é¢„å¤„ç†åï¼Œåˆæ³•çŠ¶æ€æ•°å¤§å¤§å‡å°‘ï¼ˆç‰¹åˆ«æ˜¯å½“ n è¾ƒå¤§æ—¶ï¼‰ï¼Œå¯ä»¥æ˜¾è‘—æé«˜æ•ˆç‡ã€‚

---

## ğŸ§  æ€»ç»“

| å˜é‡ | å«ä¹‰ |
|------|------|
| `cnt` | åˆæ³•çŠ¶æ€çš„æ€»æ•°ï¼ˆç”± DFS æšä¸¾å¾—åˆ°ï¼‰ |
| `sit[j]` | ç¬¬ j ä¸ªåˆæ³•çŠ¶æ€çš„äºŒè¿›åˆ¶è¡¨ç¤º |
| `sta[j]` | ç¬¬ j ä¸ªçŠ¶æ€ä¸­æ”¾äº†å¤šå°‘ä¸ªå›½ç‹ |
| `f[i][j][l]` | å‰ i è¡Œã€ç¬¬ i è¡Œä¸ºçŠ¶æ€ jã€å…±æ”¾ l ä¸ªå›½ç‹æ—¶çš„æ–¹æ¡ˆæ•° |

> **ä¸ºä»€ä¹ˆè¦ç”¨ `cnt` ä½œä¸ºç»ˆæ­¢æ¡ä»¶ï¼Ÿ**
>
> å› ä¸ºæˆ‘ä»¬åªå¤„ç†åˆæ³•çŠ¶æ€ï¼Œè€Œ `cnt` æ­£å¥½è®°å½•äº†è¿™äº›åˆæ³•çŠ¶æ€çš„æ€»æ•°ï¼Œæ‰€ä»¥æ‰€æœ‰åç»­çš„æšä¸¾éƒ½åªéœ€åˆ° `cnt` å³å¯ã€‚

---
